<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Features - Metacontroller</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Lightweight Kubernetes controllers as a service">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="examples.html"><strong aria-hidden="true">1.2.</strong> Examples</a></li><li class="chapter-item expanded "><a href="concepts.html"><strong aria-hidden="true">1.3.</strong> Concepts</a></li><li class="chapter-item expanded "><a href="features.html" class="active"><strong aria-hidden="true">1.4.</strong> Features</a></li><li class="chapter-item expanded "><a href="faq.html"><strong aria-hidden="true">1.5.</strong> FAQ</a></li><li class="chapter-item expanded "><a href="pronunciation.html"><strong aria-hidden="true">1.6.</strong> Pronunciation</a></li></ol></li><li class="chapter-item expanded "><a href="guide.html"><strong aria-hidden="true">2.</strong> User Guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="guide/install.html"><strong aria-hidden="true">2.1.</strong> Install Metacontroller</a></li><li class="chapter-item expanded "><a href="guide/helm-install.html"><strong aria-hidden="true">2.2.</strong> Install Metacontroller via helm</a></li><li class="chapter-item expanded "><a href="guide/configuration.html"><strong aria-hidden="true">2.3.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="guide/create.html"><strong aria-hidden="true">2.4.</strong> Create a controller</a></li><li class="chapter-item expanded "><a href="guide/best-practices.html"><strong aria-hidden="true">2.5.</strong> Constraints and best practices</a></li><li class="chapter-item expanded "><a href="guide/troubleshooting.html"><strong aria-hidden="true">2.6.</strong> Troubleshooting</a></li></ol></li><li class="chapter-item expanded "><a href="api.html"><strong aria-hidden="true">3.</strong> API Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/apply.html"><strong aria-hidden="true">3.1.</strong> Apply Semantics</a></li><li class="chapter-item expanded "><a href="api/compositecontroller.html"><strong aria-hidden="true">3.2.</strong> CompositeController</a></li><li class="chapter-item expanded "><a href="api/controllerrevision.html"><strong aria-hidden="true">3.3.</strong> ControllerRevision</a></li><li class="chapter-item expanded "><a href="api/decoratorcontroller.html"><strong aria-hidden="true">3.4.</strong> DecoratorController</a></li><li class="chapter-item expanded "><a href="api/customize.html"><strong aria-hidden="true">3.5.</strong> Customize Hook</a></li><li class="chapter-item expanded "><a href="api/hook.html"><strong aria-hidden="true">3.6.</strong> Hook</a></li></ol></li><li class="chapter-item expanded "><a href="design.html"><strong aria-hidden="true">4.</strong> Design Docs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="design/map-controller.html"><strong aria-hidden="true">4.1.</strong> MapController</a></li></ol></li><li class="chapter-item expanded "><a href="contrib.html"><strong aria-hidden="true">5.</strong> Contributing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="contrib/build.html"><strong aria-hidden="true">5.1.</strong> Building</a></li><li class="chapter-item expanded "><a href="contrib/debug.html"><strong aria-hidden="true">5.2.</strong> Local development/debug</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Metacontroller</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/metacontroller/metacontroller" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="features"><a class="header" href="#features">Features</a></h1>
<p>This is a high-level overview of what Metacontroller provides
for Kubernetes controller authors.</p>
<ul>
<li><a href="#dynamic-scripting">Dynamic Scripting</a></li>
<li><a href="#controller-best-practices">Controller Best Practices</a></li>
<li><a href="#declarative-watches">Declarative Watches</a></li>
<li><a href="#declarative-reconciliation">Declarative Reconciliation</a></li>
<li><a href="#declarative-declarative-rolling-update">Declarative Declarative Rolling Update</a></li>
</ul>
<h2 id="dynamic-scripting"><a class="header" href="#dynamic-scripting">Dynamic Scripting</a></h2>
<p>With Metacontroller's <a href="./concepts.html#lambda-controller">hook-based design</a>, you can write <a href="./concepts.html#controller">controllers</a>
in any language while still taking advantage of the efficient machinery we
developed in Go for core controllers.</p>
<p>This makes Metacontroller especially useful for rapid development
of automation in dynamic scripting languages like Python or JavaScript,
although you're also free to use statically-typed languages like Go or Java.</p>
<p>To support fast ramp-up and iteration on your ideas,
Metacontroller makes it possible to write controllers with:</p>
<ul>
<li>No schema/IDL</li>
<li>No generated code</li>
<li>No library dependencies</li>
<li>No container image build/push</li>
</ul>
<h2 id="controller-best-practices"><a class="header" href="#controller-best-practices">Controller Best Practices</a></h2>
<p>Controllers you write with Metacontroller automatically behave like
first-class citizens out of the box, before you write any code.</p>
<p>All interaction with the Kubernetes API happens inside the Metacontroller
server in response to your instructions.
This allows Metacontroller to implement best practices learned from writing
core controllers without polluting your business logic.</p>
<p>Even the simplest <a href="./guide/create.html">Hello, World</a> example with Metacontroller
already takes care of:</p>
<ul>
<li>Label selectors (for defining flexible collections of objects)</li>
<li>Orphan/adopt semantics (controller reference)</li>
<li>Garbage collection (owner references for automatic cleanup)</li>
<li>Watches (for low latency)</li>
<li>Caching (shared informers/reflectors/listers)</li>
<li>Work queues (deduplicated parallelism)</li>
<li>Optimistic concurrency (resource version)</li>
<li>Retries with exponential backoff</li>
<li>Periodic relist/resync</li>
</ul>
<h2 id="declarative-watches"><a class="header" href="#declarative-watches">Declarative Watches</a></h2>
<p>Rather than writing boilerplate code for each type of <a href="./concepts.html#resource">resource</a>
you want to watch, you simply list those resources declaratively:</p>
<pre><code class="language-yaml">childResources:
- apiVersion: v1
  resource: pods
- apiVersion: v1
  resource: persistentvolumeclaims
</code></pre>
<p>Behind the scenes, Metacontroller sets up watch streams that are shared across
all controllers that use Metacontroller.</p>
<p>That means, for example, that you can create as many <a href="./concepts.html#lambda-controller">lambda controllers</a>
as you want that watch Pods, and the API server will only need to send one Pod
watch stream (to Metacontroller itself).</p>
<p>Metacontroller then acts like a demultiplexer, determining which controllers will
care about a given event in the stream and triggering their hooks only as needed.</p>
<h2 id="declarative-reconciliation"><a class="header" href="#declarative-reconciliation">Declarative Reconciliation</a></h2>
<p>A large part of the expressiveness of the Kubernetes API is due to its focus on
declarative management of cluster state, which lets you directly specify an
end state without specifying how to get there.
Metacontroller expands on this philosophy, allowing you to define controllers
in terms of what they want without specifying how to get there.</p>
<p>Instead of thinking about imperative operations like create/read/update/delete,
you just generate a list of all the things you want to exist.
Based on the current cluster state, Metacontroller will then determine what
actions are required to move the cluster towards your desired state and
maintain it once its there.</p>
<p>Just like the built-in controllers, the reconciliation that Metacontroller
performs for you is <a href="https://hackernoon.com/level-triggering-and-reconciliation-in-kubernetes-1f17fe30333d">level-triggered</a> so it's resilient to downtime
(missed events), yet optimized for low latency and low API load through shared
watches and caches.</p>
<p>However, the clear separation of <em>deciding what you want</em> (the hook you write)
from <em>running a low-latency, level-triggered reconciliation loop</em>
(what Metacontroller does for you) means you don't have to think about this.</p>
<h2 id="declarative-declarative-rolling-update"><a class="header" href="#declarative-declarative-rolling-update">Declarative Declarative Rolling Update</a></h2>
<p>Another big contributor to the power of Kubernetes APIs like Deployment and
StatefulSet is the ability to declaratively specify gradual state transitions.
When you update your app's container image or configuration, for example, these
controllers will slowly roll out Pods with the new template and automatically
pause if things don't look right.</p>
<p>Under the hood, implementing gradual state transitions with level-triggered
reconcilation loops involves careful bookkeeping with auxilliary records,
which is why StatefulSet originally launched without rolling updates.
Metacontroller lets you easily build your own APIs that offer declarative
rolling updates without making you think about all this additional bookkeeping.</p>
<p>In fact, Metacontroller provides a declarative interface for configuring how
you want to implement declarative rolling updates in your controller
(<em>declarative declarative rolling update</em>),
so you don't have to write any code to take advantage of this feature.</p>
<p>For example, <a href="https://www.github.com/GoogleCloudPlatform/metacontroller/pull/22/files">adding support for rolling updates</a>
to a Metacontroller-based <a href="./examples.html#catset-javascript">rewrite of StatefulSet</a>
looks essentially like this:</p>
<pre><code class="language-diff">   childResources:
   - apiVersion: v1
     resource: pods
+    updateStrategy:
+      method: RollingRecreate
+      statusChecks:
+        conditions:
+        - type: Ready
+          status: &quot;True&quot;
</code></pre>
<p>For comparison, the corresponding pull request to
<a href="https://github.com/kubernetes/kubernetes/pull/46669">add rolling updates to StatefulSet itself</a> involved
over 9,000 lines of changes to business logic, boilerplate, and generated code.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="concepts.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="faq.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="concepts.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="faq.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
